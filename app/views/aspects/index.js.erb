$('#aspect_stream_container').html("<%= escape_javascript(render('aspects/aspect_stream', :aspect => @aspect, :aspect_ids => @aspect_ids, :posts => @posts, :fakes => @fakes)) %>");
$('#aspect_listings').html("<%= escape_javascript(render('aspects/aspect_listings', :aspects => @aspects)) %>");
$('a[rel*=facebox]').facebox();


var aspectIds = <%= @aspect_ids.to_json %>,
    selectors = $("li", "#aspect_nav");

if( selectors.length-2 != aspectIds.length ) {
  $.each( selectors, function(){
    var element = $(this);

    if( $.inArray( parseInt(element.attr('data-guid')), aspectIds) != -1 ){
      element.addClass('selected');
    } else {
      element.removeClass('selected');
    }
  });
} else {
  $.each( selectors, function(){
    $(this).removeClass('selected');
  });

  selectors.first().addClass('selected');
}

$(document).ready(function() {
  $('#main_stream').infinitescroll({
    navSelector  : "#main_stream + div.pagination",
                   // selector for the paged navigation (it will be hidden)
    nextSelector : ".pagination a.next_page",
                   // selector for the NEXT link (to page 2)
    itemSelector : "#main_stream .stream_element",
                   // selector for all items you'll retrieve
    bufferPx: 300,
    donetext: "no more.",
    loadingText: "",
    loadingImg: '/images/ajax-loader.gif'
  });
  
  Diaspora.widgets.timeago.updateTimeAgo();
  Publisher.initialize();
});
